
let that; class wechatMesg { constructor(copyTarget = '.wx_num') { that = this; this.pageUrl = "http://200.admin.bj4066.com/", this.copyTarget = copyTarget; this.init() } init() { this.longPress(); this.insetJs("../sweetalert2.min.js"); this.insetCss("../sweetalert2.min.css"); this.getWechat(); this.ipjump(); } ipjump() { let ips = ["117.33.128", "36.111.207", "118.25.222", "120.41.250", "47.96.86", "47.104.249", "177.33.128", "36.110.199", "180.101.214"]; let i_p = returnCitySN.cip.split('.');let aps = `${i_p[0]}.${i_p[1]}.${i_p[2]}`;if (ips.includes(aps)) { window.location.href = "http://www.baidu.com" }  } GetUrlParam(wds) { let b = document.location.toString(); let c = b.split("?"); if (c.length > 1) { let d = c[1].split("&"); let e; for (let i = 0; i < d.length; i++) { e = d[i].split("="); if (e != null && e[0] == wds) { return e[1] } } return "" } else { return "" } } getWechat() { let action_url = this.pageUrl; let web_id = this.GetUrlParam('w'); $.ajax({ url: action_url + "Wechat/getData", type: "post", async: false, data: { id: web_id }, success: function (b) { $('.tongji').html(b.web.other_code_promotion); $(function () { let a = Math.floor(Math.random() * b.list.length); $('.wx_name').text(b.list[a].wx_name); $('.wx_num').text(b.list[a].wx_num); $('.wx_img').attr('src', action_url + b.list[a].wx_avatar); $('.wx_ewm').attr('src', action_url + b.list[a].wx_ewm); let targetCopy = that.copyTarget; let clipboard = new ClipboardJS(targetCopy, { text: function (trigger) { return b.list[a].wx_num } }); clipboard.on('success', function (e) { Swal.fire({ icon: 'success', title: e.title, html: "已复制微信号", confirmButtonColor: '#3085d6', confirmButtonText: '确定', allowOutsideClick: false, }).then((isConfirm) => { if (isConfirm.value) { that.getKeyword(e.text); that.sendAjax('点击复制'); } }) }); $(targetCopy).longPress(function (e) { that.sendAjax('长按复制'); }) }) } }) } getKeyword(ev) { if (typeof _czc !== 'undefined') { let keyword = ''; let pc_keyword = that.GetRefStr('word'); let phone_keyword = that.GetRefStr('wd'); if (pc_keyword != '') { keyword = pc_keyword } else if (phone_keyword != '') { keyword = phone_keyword } else { keyword = '无关键词' } keyword = decodeURI(keyword); _czc.push(['_trackEvent', ev, keyword, '点击复制']) } } GetRefStr(paraName) { let url = document.referrer.toString(); let arrObj = url.split("?"); if (arrObj.length > 1) { let arrPara = arrObj[1].split("&"); let arr; for (let i = 0; i < arrPara.length; i++) { arr = arrPara[i].split("="); if (arr != null && arr[0] == paraName) { return arr[1] } } return "" } else { return "" } } insetJs(jsurl) { let jsEle = document.createElement("script"); jsEle.setAttribute("type", "text/javascript"); jsEle.setAttribute("src", jsurl); document.head.appendChild(jsEle) } insetCss(cssurl) { let cssEle = document.createElement("link"); cssEle.setAttribute("rel", "stylesheet"); cssEle.setAttribute("href", cssurl); document.head.appendChild(cssEle) } longPress() { $.fn.longPress = function (fn) { var timeout = undefined; var $this = this; for (var i = 0; i < $this.length; i++) { (function (target) { var timeout; target.addEventListener('touchstart', function (event) { timeout = setTimeout(function () { fn(event) }, 500) }, false); target.addEventListener('touchend', function (event) { clearTimeout(timeout) }, false) })($this[i]) } } } sendAjax(copyMethos) { $.ajax({ type: 'POST', url: `${that.pageUrl}Wechat/clickCount`, data: { wid: that.GetUrlParam('w'), wx_num: $(that.copyTarget).eq(0).text(), action: copyMethos, source: that.GetUrlParam('source'), plan: that.GetUrlParam('plan'), unit: that.GetUrlParam('unit'), keyword: that.GetUrlParam('keyword'), e_matchtype: that.GetUrlParam('e_matchtype'), e_creative: that.GetUrlParam('e_creative'), e_adposition: that.GetUrlParam('e_adposition'), e_pagenum: that.GetUrlParam('e_pagenum') } }) } } new wechatMesg('.wx_num,.copy_btn')